<!DOCTYPE html>
<html lang="en-us">

  <head>
    <!-- Global site tag (gtag.js) - Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=UA-146683329-1"></script>
    <script>
      window.dataLayer = window.dataLayer || [];
      function gtag(){dataLayer.push(arguments);}
      gtag('js', new Date());

      gtag('config', 'UA-146683329-1');
    </script>
    <meta charset="utf-8">
    <title>Planimation</title>
    <style>
      body { margin: 0; }
      #gameContainer { width: 100vw; height: 100vh; }
      canvas { width: 100%; height: 100%; }
    </style>
    <script src="Build/UnityLoader.js"></script>
    <script>
      var domText="";
      var probText="";
      var animateText="";
      var planText="";
      var solverURL="";

      function UnityProgress(gameObject, progress) {
          if (progress == 1){
            console.log("Unity Load Successful");
            window.parent.postMessage({"action":"loadfile"}, "*");    
          }
      }

      var gameInstance = UnityLoader.instantiate("gameContainer", "%UNITY_WEBGL_BUILD_URL%",{onProgress: UnityProgress});
    
      function solve(){
        gameInstance.SendMessage("Coordinator","planimationPlugin");
        gameInstance.SendMessage("Coordinator","setDomain",domText);
        gameInstance.SendMessage("Coordinator","setProblem",probText);
        gameInstance.SendMessage("Coordinator","setAnimation",animateText);
        gameInstance.SendMessage("Coordinator","setPlan",planText);
        gameInstance.SendMessage("Coordinator","setCustomSolver",solverURL);
        gameInstance.SendMessage("Coordinator","uploadallfile");
      }

      window.addEventListener('message',function(event) {
        if (event.data.domText){           
          domText=event.data.domText;
          probText=event.data.probText;
          animateText=event.data.animateText;
          planText=event.data.planText;
          solverURL=event.data.solverURL;
          solve();
        }
      },false);
    </script>
    <!-- (Apr 23, 2020) Drag and Drop update: added script -->
    <script type="text/javascript" src="dragdrop.js"></script>
    <link rel="stylesheet" type="text/css" href="dragdrop.css">
  </head>

  <body>
    <div id="gameContainer"></div>
    
    <!-- [start] (Apr 23, 2020) Drag and Drop update -->
    <!-- modal section for file type input -->
    <a href="#modal-01" id="modal-open"></a>
    <div class="modal-wrapper" id="modal-01">
      <a href="#!" class="modal-overlay"></a>
      <div class="modal-window">
        <div class="modal-content" id="modal-content">
          <div>Select File Type</div>
          <div id="file-type"></div>
          <button id="modal-submit">submit</button>
          <button id="modal-cancel">cancel</button>
        </div>
        <a href="#!" class="modal-close" id="modal-close"></a>
      </div>
    </div>
    <!-- [end] (Apr 23, 2020) Drag and Drop update -->
  
  </body>
</html>